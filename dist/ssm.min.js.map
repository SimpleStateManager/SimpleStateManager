{"version":3,"file":"ssm.min.js","sources":["../src/utils.js","../src/state.js","../src/ssm.js"],"sourcesContent":["export function filterStates(states, key, value) {\n    return states.filter((state) => {\n        return state[key] && state[key] === value;\n    });\n}\n\nexport function makeID() {\n    return Math.random().toString(36).substr(2, 9);\n}\n\nexport function fireAllMethodsInArray(arr) {\n    arr.forEach(method => method());\n}\n\nexport function funcToArray(func) {\n    return typeof func === 'function' ? [func] : func;\n}\n\nexport function debounce(func) {\n    var timeout;\n    \n    return function() {\n        var args = arguments;\n        var later = () => {\n            timeout = null;\n            func.apply(this, args);\n        };\n\n        if (timeout) {\n            window.cancelAnimationFrame(timeout);\n        }\n\n        timeout =  window.requestAnimationFrame(later);\n    };\n}","import {\n    fireAllMethodsInArray,\n    makeID,\n} from './utils';\n\nconst configOptions = [];\nlet stateChangeMethod = function () { };\n\nexport default class State {\n    constructor(options) {\n        this.id = options.id || makeID();\n        this.query = options.query || 'all';\n        // These are exposed as part of the state, not options so delete before\n        // we merge these into default options.\n        delete options.id;\n        delete options.query;\n\n        var defaultOptions = {\n            onEnter: [],\n            onLeave: [],\n            onResize: [],\n            onFirstRun: []\n        };\n\n        //Merge options with defaults to make the state\n        this.options = Object.assign({}, defaultOptions, options);\n\n        //Migrate methods into an array, this is to enable future functionality of adding extra methods to an existing state\n        if (typeof this.options.onEnter === \"function\") {\n            this.options.onEnter = [this.options.onEnter];\n        }\n\n        if (typeof this.options.onLeave === \"function\") {\n            this.options.onLeave = [this.options.onLeave];\n        }\n\n        if (typeof this.options.onResize === \"function\") {\n            this.options.onResize = [this.options.onResize];\n        }\n\n        if (typeof this.options.onFirstRun === \"function\") {\n            this.options.onFirstRun = [this.options.onFirstRun];\n        }\n\n        //Test the one time tests first, if the test is invalid we wont create the config option\n        if (this.testConfigOptions('once') === false) {\n            this.valid = false;\n            return false;\n        }\n\n        this.valid = true;\n        this.active = false;\n        this.init();\n    }\n\n    init() {\n        this.test = window.matchMedia(this.query);\n\n        if (this.test.matches && this.testConfigOptions('match')) {\n            this.enterState();\n        }\n\n        this.listener = function (test) {\n            var changed = false;\n\n            if (test.matches) {\n                if (this.testConfigOptions('match')) {\n                    this.enterState();\n                    changed = true;\n                }\n            } else {\n                this.leaveState();\n                changed = true;\n            }\n\n            if (changed) {\n                stateChangeMethod();\n            }\n        }.bind(this);\n\n        this.test.addListener(this.listener);\n    }\n\n    //Handle entering a state\n    enterState() {\n        fireAllMethodsInArray(this.options.onFirstRun);\n        fireAllMethodsInArray(this.options.onEnter);\n        this.options.onFirstRun = [];\n        this.active = true;\n    }\n\n    //Handle leaving a state\n    leaveState() {\n        fireAllMethodsInArray(this.options.onLeave);\n        this.active = false;\n    }\n\n    //Handle the user resizing the browser\n    resizeState() {\n        if (this.testConfigOptions('resize')) {\n            fireAllMethodsInArray(this.options.onResize);\n        }\n    }\n\n    //When the StateManager removes a state we want to remove the event listener\n    destroy() {\n        this.test.removeListener(this.listener);\n    }\n\n    attachCallback(type, callback, runIfActive) {\n        switch (type) {\n            case 'enter':\n                this.options.onEnter.push(callback);\n                break;\n            case 'leave':\n                this.options.onLeave.push(callback);\n                break;\n            case 'resize':\n                this.options.onResize.push(callback);\n                break;\n        }\n\n        if (type === 'enter' && runIfActive && this.active) {\n            callback();\n        }\n    }\n\n    testConfigOptions(when) {\n        var totalConfigOptions = configOptions.length;\n\n        for (var j = 0; j < totalConfigOptions; j++) {\n            var configOption = configOptions[j];\n\n            if (typeof this.options[configOption.name] !== \"undefined\") {\n                if (configOption.when === when && configOption.test.bind(this)() === false) {\n                    return false;\n                }\n            }\n        }\n\n        return true;\n    }\n\n    static addConfigOption(configOption) {\n        configOptions.push(configOption);\n    }\n\n    static getConfigOptions() {\n        return configOptions;\n    }\n\n    static removeConfigOption(name) {\n        configOptions.forEach((item, index) => {\n            if (item.name === name) {\n                configOptions.splice(index, 1);\n            }\n        });\n    }\n\n    static setStateChangeMethod(func) {\n        if (typeof func === \"function\") {\n            stateChangeMethod = func;\n        }\n        else {\n            throw new Error('Not a function');\n        }\n    }\n}","import State from './state';\nimport {\n    debounce,\n    funcToArray,\n    fireAllMethodsInArray,\n    makeID,\n    filterStates,\n} from './utils';\n\nvar resizeTimeout = 25;\n\nfunction Error(message) {\n    this.message = message;\n    this.name = \"Error\";\n}\n\n//State Manager Constructor\nclass StateManager {\n    constructor(options) {\n        this.states = [];\n        this.resizeTimer = null;\n        this.configOptions = [];\n\n        window.addEventListener(\"resize\", debounce(this.resizeBrowser.bind(this), resizeTimeout), true);    \n    }\n\n    addState(options) {\n        var newState = new State(options);\n        \n        if (newState.valid) {\n            this.states.push(newState);\n        }\n\n        return newState;\n    }\n\n    addStates(statesArray) {\n        for (var i = statesArray.length - 1; i >= 0; i--) {\n            this.addState(statesArray[i]);\n        }\n    }\n\n    getState(id) {\n        for (var i = this.states.length - 1; i >= 0; i--) {\n            var state = this.states[i];\n\n            if(state.id === id){\n                return state;\n            }\n        }\n    }\n\n    isActive(id) {\n        var selectedState = this.getState(id) || {};\n\n        return selectedState.active || false;\n    }\n\n    getStates(idArr)  {\n        var idCount = null, returnArr = [];\n\n        if (typeof(idArr) === \"undefined\") {\n            return this.states;\n        }\n        else {\n            return idArr.map((id) => {\n                return this.getState(id)\n            });\n        }\n    }\n\n    removeState(id) {\n        this.states.forEach((state, index) => {\n            if (state.id === id) {\n                state.destroy();\n                this.states.splice(index, 1);\n            }\n        });\n    }\n\n    removeStates(idArray) {\n        idArray.forEach((id) => this.removeState(id));\n    }\n\n    removeAllStates() {\n        this.states.forEach(state => state.destroy());\n        this.states = [];\n    }\n\n    addConfigOption(options) {\n        const defaultOptions = {\n            name: '', // name, this is used to apply to a state\n            test: null, //function which will perform the test\n            when: 'resize' // resize or match (match will mean that resize will never fire either), or once (which will test once, then delete state if test doesnt pass)\n        };\n\n        //Merge options with defaults\n        options = Object.assign({}, defaultOptions, options);\n\n        if (options.name !== '' && options.test !== null) {\n            State.addConfigOption(options);\n        }\n    }\n\n    removeConfigOption(name) {\n        State.removeConfigOption(name);\n    }\n\n    getConfigOptions(name) {\n        var configOptions = State.getConfigOptions();\n\n        if(typeof name === \"string\"){\n            return configOptions.filter(configOption =>  configOption.name === name);\n        }\n        else{\n            return configOptions;\n        }\n    }\n\n    resizeBrowser() {\n        const activeStates = filterStates(this.states, 'active', true);\n\n        activeStates.forEach((state) => {\n            state.resizeState();\n        });\n    }\n\n    stateChange(func) {\n        State.setStateChangeMethod(func);\n    }\n}\n\nexport default new StateManager();\n"],"names":["filterStates","states","key","value","filter","state","makeID","Math","random","toString","substr","fireAllMethodsInArray","arr","forEach","method","debounce","func","timeout","args","arguments","cancelAnimationFrame","window","requestAnimationFrame","apply","configOptions","stateChangeMethod","State","options","id","query","defaultOptions","Object","assign","this","onEnter","onLeave","onResize","onFirstRun","testConfigOptions","valid","active","init","test","matchMedia","matches","enterState","listener","changed","leaveState","bind","addListener","removeListener","type","callback","runIfActive","push","when","totalConfigOptions","length","j","configOption","name","item","index","splice","Error","resizeTimeout","resizeTimer","addEventListener","resizeBrowser","newState","statesArray","i","addState","getState","idArr","map","_this","destroy","idArray","_this3","removeState","addConfigOption","removeConfigOption","getConfigOptions","resizeState","setStateChangeMethod"],"mappings":"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"}